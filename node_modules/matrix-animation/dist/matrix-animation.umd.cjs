(function(r,a){typeof exports=="object"&&typeof module<"u"?a(exports):typeof define=="function"&&define.amd?define(["exports"],a):(r=typeof globalThis<"u"?globalThis:r||self,a(r.MatrixAnimation={}))})(this,function(r){"use strict";var m=Object.defineProperty;var d=(r,a,e)=>a in r?m(r,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[a]=e;var n=(r,a,e)=>(d(r,typeof a!="symbol"?a+"":a,e),e);const a=(c,i)=>Math.floor(Math.random()*(i-c)+c),e=(c,i)=>Math.random()*(i-c)+c;class p{constructor(i,t={}){n(this,"container");n(this,"_ctx");n(this,"_canvas");n(this,"frameId",0);n(this,"fadeInterval",0);n(this,"canvasWidth",0);n(this,"canvasHeight",0);n(this,"availableCharSets",[]);n(this,"raindrops",[]);n(this,"mutationObserver");n(this,"resizeObserver");n(this,"performCanvasShift",()=>{});n(this,"stopAnimation",!1);n(this,"hasCreatedCanvas",!1);n(this,"rainWidth",0);n(this,"render",(()=>{this.stopAnimation||(this.drawRain(),this.frameId=requestAnimationFrame(this.render))}).bind(this));this.selector=i,this.options=t,this.applyOptions(t),this.setupElements(),this.resizeObserver=new ResizeObserver(()=>this.onResize()),this.resizeObserver.observe(this.container),this.mutationObserver=new MutationObserver(s=>{s.forEach(o=>{const h=[...o.removedNodes.values()];(h.includes(this.container)||h.includes(this.canvas))&&this.dispose()})}),this.mutationObserver.observe(this.container,{childList:!0}),this.initCanvasShift(),this.initCanvas()}get canvas(){return this._canvas}get ctx(){return this._ctx??(this._ctx=this.canvas.getContext("2d"))}dispose(){this.pause(),this.resizeObserver.disconnect(),this.mutationObserver.disconnect(),this.raindrops.forEach(i=>{}),this.hasCreatedCanvas&&this.canvas.remove()}play(){this.fadeInterval&&clearInterval(this.fadeInterval),this.frameId&&cancelAnimationFrame(this.frameId),this.stopAnimation=!1,this.fadeInterval=setInterval(()=>{this.ctx.fillStyle=`rgba(0,0,0,${this.options.fadeStrength??.05})`,this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight)},20),this.render()}pause(){this.stopAnimation=!0,cancelAnimationFrame(this.frameId),clearInterval(this.fadeInterval)}applyOptions(i=this.options){var s,o;if(typeof this.options!="object")throw new Error("Options must be an object");this.options.minFrameTime=i.minFrameTime??50,this.options.rainGenerator=i.rainGenerator??{},this.options.rainGenerator.density=((s=this.options.rainGenerator)==null?void 0:s.density)??((o=i.rainGenerator)==null?void 0:o.density)??2,Array.isArray(this.options.rainDrop)?this.rainWidth=12:(this.options.rainDrop=this.options.rainDrop??{},this.rainWidth=this.options.rainDrop.rainWidth=this.options.rainDrop.rainWidth??12,this.options.rainDrop.alignToColumns=this.options.rainDrop.alignToColumns??!0),Object.entries(i).filter(([h])=>h!="rainDrop").forEach(([h,l])=>this.options[h]=l),typeof i.rainDrop=="object"&&Object.entries(i.rainDrop).forEach(([h,l])=>this.options.rainDrop[h]=l),typeof i.rainGenerator=="object"&&Object.entries(i.rainGenerator).forEach(([h,l])=>this.options.rainGenerator[h]=l);let t=this.options.charArrays?Array.isArray(this.options.charArrays)?this.options.charArrays:[this.options.charArrays]:Array.isArray(this.options.rainDrop)?["0123456789"]:this.options.rainDrop.charArrays?Array.isArray(this.options.rainDrop.charArrays)?this.options.rainDrop.charArrays:[this.options.rainDrop.charArrays]:["0123456789"];this.availableCharSets=t}onResize(i=!0){const t=this.container.clientWidth-this.canvasWidth,s=this.container.clientHeight-this.canvasHeight;this.canvas.width=this.canvasWidth=this.container.clientWidth,this.canvas.height=this.canvasHeight=this.container.clientHeight,i&&(t>0&&this.createRaindrops(!0),t<0&&(this.raindrops=this.raindrops.filter(o=>o.x<this.canvasWidth)),s<0&&(this.raindrops=this.raindrops.filter(o=>o.x<this.canvasWidth)))}resetRaindrops(){this.raindrops.splice(0),this.createRaindrops()}setupElements(){if(typeof this.selector=="string"){let t=document.querySelector(this.selector);if(!t)throw new Error('No element matching selector "'+this.selector+'"');t.nodeName=="CANVAS"?this.container=t.parentElement:this.container=t}else if(this.selector instanceof HTMLElement)this.selector.nodeName=="CANVAS"?this.container=this.selector.parentElement:this.container=this.selector;else{const t=new Error("Invalid selector passed to MatrixAnimation");throw t.selector=this.selector,t.options=this.options,t}let i=this.container.querySelector("canvas");i||(this.hasCreatedCanvas=!0,i=document.createElement("canvas"),this.container.append(i)),this._canvas=i,getComputedStyle(this.container).position=="static"&&(this.container.style.position="relative"),i.style.width="100%",i.style.height="100%",i.style.position="absolute"}initCanvasShift(){switch(this.options.windDirection){case"LR":{this.performCanvasShift=()=>{this.ctx.globalCompositeOperation="copy",this.ctx.drawImage(this.ctx.canvas,this.options.windSpeed,0),this.ctx.globalCompositeOperation="source-over"};break}case"BU":{this.performCanvasShift=()=>{this.ctx.globalCompositeOperation="copy",this.ctx.drawImage(this.ctx.canvas,0,-this.options.windSpeed),this.ctx.globalCompositeOperation="source-over"};break}case"RL":{this.performCanvasShift=()=>{this.ctx.globalCompositeOperation="copy",this.ctx.drawImage(this.ctx.canvas,-this.options.windSpeed,0),this.ctx.globalCompositeOperation="source-over"};break}case"TD":{this.performCanvasShift=()=>{this.ctx.globalCompositeOperation="copy",this.ctx.drawImage(this.ctx.canvas,0,this.options.windSpeed),this.ctx.globalCompositeOperation="source-over"};break}}}initCanvas(){this.onResize(!1),this.createRaindrops(),this.ctx.textAlign="center",this.ctx.imageSmoothingEnabled=!1}createRaindrops(i=!1){if(i||this.raindrops.splice(0),!Array.isArray(this.options.rainDrop)){const t=this.options.rainGenerator,s=this.canvasWidth/this.rainWidth;let o=t.count?t.count:~~((t.density??2)*s);if(Array.isArray(this.options.rainDrop))throw new Error("Cannont set rainDrops when rainGenerator is set");const h=structuredClone(this.options.rainDrop);for(;o--;)this.raindrops.push(new f(this.options.rainDrop.alignToColumns??this.options.alignToColumns?t.density?a(0,s)*this.rainWidth:o%s*this.rainWidth:e(0,this.canvasWidth),e(0,this.canvasHeight),this,h))}this.options.autoStart!=!1&&this.play()}drawRain(){let i=this.raindrops.length;const t=Date.now();for(this.ctx.shadowColor=this.options.trailBloomColor,this.ctx.shadowBlur=this.options.trailBloomSize;i--;){const s=this.raindrops[i];t-s.lastFrameTime>s.config.frameDelay&&s.clear(this.ctx)}for(this.ctx.shadowColor="",this.ctx.shadowBlur=0,this.options.windSpeed>0&&this.performCanvasShift(),i=this.raindrops.length,this.ctx.shadowColor=this.options.trailBloomColor,this.ctx.shadowBlur=this.options.trailBloomSize;i--;){const s=this.raindrops[i];t-s.lastFrameTime>s.config.frameDelay&&(s.draw(this.ctx),s.lastFrameTime=t)}this.ctx.shadowColor="",this.ctx.shadowBlur=0}}class f{constructor(i,t,s,o={}){n(this,"charList",[]);n(this,"trailChars",[]);n(this,"shiftDirection");n(this,"trailLength");n(this,"font");n(this,"lastFrameTime",0);this.x=i,this.y=t,this.matrixAnimation=s,this.config=o,this.initConfig(),this.randomizeChars(),this.initMoveDirection(),this.onRespawn()}initConfig(){Object.keys(this.matrixAnimation).forEach(i=>{this.config[i]=this.config[i]??this.matrixAnimation[i]}),this.trailLength=this.matrixAnimation.options.trailColorLogic=="sequential"?(this.config.trailColors??[]).length:1,this.font=(this.config.fontSize??14)+"px "+(this.config.fontFamily??"Arial")}initMoveDirection(){const i=()=>{this.x>this.matrixAnimation.canvasWidth?this.x=1:this.x<0&&(this.x=this.matrixAnimation.canvasWidth-1)},t=()=>{this.y>this.matrixAnimation.canvasHeight?this.y=1:this.y<0&&(this.y=this.matrixAnimation.canvasHeight-1)};switch(this.config.direction){case"LR":{this.shiftDirection=()=>{this.x+=this.config.minMoveSpeed&&this.config.maxMoveSpeed?e(this.config.minMoveSpeed,this.config.maxMoveSpeed):this.matrixAnimation.options.rainWidth??0,this.x>this.matrixAnimation.canvasWidth&&(this.randomizeChars(),this.x=e(-100,0),this.onRespawn()),t()};break}case"BU":{this.shiftDirection=()=>{this.y-=this.config.minMoveSpeed&&this.config.maxMoveSpeed?e(this.config.minMoveSpeed,this.config.maxMoveSpeed):this.matrixAnimation.options.rainHeight??0,this.y<0&&(this.randomizeChars(),this.y=e(this.matrixAnimation.canvasHeight,this.matrixAnimation.canvasHeight+100),this.onRespawn()),i()};break}case"RL":{this.shiftDirection=()=>{this.x-=this.config.minMoveSpeed&&this.config.maxMoveSpeed?e(this.config.minMoveSpeed,this.config.maxMoveSpeed):this.matrixAnimation.options.rainWidth??0,this.x<0&&(this.randomizeChars(),this.x=e(this.matrixAnimation.canvasWidth,this.matrixAnimation.canvasWidth+100),this.onRespawn()),t()};break}case"TD":default:{this.shiftDirection=()=>{this.y+=this.config.minMoveSpeed&&this.config.maxMoveSpeed?e(this.config.minMoveSpeed,this.config.maxMoveSpeed):this.matrixAnimation.options.rainHeight??0,this.y>this.matrixAnimation.canvasHeight&&(this.randomizeChars(),this.y=e(-100,0),this.onRespawn()),i()};break}}}randomizeChars(){this.charList=this.matrixAnimation.availableCharSets[~~(Math.random()*this.matrixAnimation.availableCharSets.length)]}onRespawn(){var i;if(((i=this.matrixAnimation.options.charArrays)==null?void 0:i.length)>1&&this.randomizeChars(),this.config.randomizeFrameDelay&&(this.config.frameDelay=a(this.config.minFrameDelay??30,this.config.maxFrameDelay??60)),this.config.randomizePosition)if(this.config.direction=="LR"||this.config.direction=="RL"){const t=this.matrixAnimation.canvasHeight/this.config.rainWidth;this.config.alignToColumns?this.y=a(0,t)*this.config.rainWidth:this.y=e(0,this.matrixAnimation.canvasHeight)}else{const t=this.matrixAnimation.canvasWidth/this.config.rainWidth;this.config.alignToColumns?this.x=a(0,t)*this.config.rainWidth:this.x=e(0,this.matrixAnimation.canvasWidth)}}clear(i){let t=this.trailChars.length;for(;t--;){const s=this.trailChars[t],o=this.config.trailColors?this.matrixAnimation.options.trailColorLogic=="sequential"?this.config.trailColors[t]??this.config.trailColors[this.config.trailColors.length-1]:this.config.trailColors[a(0,this.config.trailColors.length)]:this.config.trailColor||"#fff";i.fillStyle=o,i.font=this.font,i.fillText(s.char,s.x,s.y)}}draw(i){const t=this.charList[a(0,this.charList.length-1)];this.trailChars.unshift({char:t,x:this.x,y:this.y}),this.trailChars.splice(this.trailLength),i.shadowColor=this.matrixAnimation.options.headBloomColor,i.shadowBlur=this.matrixAnimation.options.headBloomSize,i.fillStyle=this.config.headColor??"rgba(255,255,255,0.8)",i.font=this.font,i.fillText(t,this.x,this.y),i.shadowColor="",i.shadowBlur=0,(this.config.jitterDownStrength||this.config.jitterUpStrength)&&(this.y+=e(-(this.config.jitterUpStrength??0),this.config.jitterDownStrength??0)),(this.config.jitterLeftStrength||this.config.jitterRightStrength)&&(this.x+=e(-(this.config.jitterLeftStrength??0),this.config.jitterRightStrength??0)),this.shiftDirection()}}r.MatrixAnimation=p,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=matrix-animation.umd.cjs.map
